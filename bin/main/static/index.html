<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>glasswindow.com</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
        <style>
            header {
                margin-top: 20px;
                color: rgb(60, 189, 0);
            }

            .jumbotron{
                padding-top: 12px;
                padding-bottom: 20px;
                margin-top: 1em;
                margin-bottom: 0em;
            }

            input {
                margin-right: 10px;
            }

            .jobSearchArea {
                margin-top: 10px;
            }

            #postJobOptionBtn, #postjobbtn{
                margin-top: 15px;
                padding: 0.2em 1em 0.2em 1em;
            }

            .job {
                background-color: rgb(228, 228, 228);
                padding-top: 15px;
                padding-bottom: 5px;
                margin-bottom: 10px;
            }

            #output {
                position: relative;
            }

            #jobpost,#jobresponse {
                position: absolute;
                display: none;
            }

            .form-group label {
                font-weight: bold;
            }

            .btnkeyword {
                display: inline;
                margin-right: 3px;
                margin-top: 1px;
                border-radius: 2em;
                padding: 0em 0.7em 0em 0.7em;
                background-color: #0073b1;
                color: white;
                font-size: 14px;
            }

            .btnkeyword:focus {
                outline:none;
            }

            p {
               font-size: 14px;
               margin-bottom: 3px;
            }

            .form-group label{
                font-size: 14px;
            }

            .nomatchfoundalert {
                background-color: rgb(255, 133, 133);
                color: #000;
                padding-top: 5px;
            }

            .jobDescription {
                font-size: 6px;
            }
            
        </style>
    </head>
    <body>
       
        <header class="container">
            <div class="row justify-content-center">
                <h1 class="col-auto">glasswindow.com</h1>
            </div>
        </header>

        <div class="jumbotron">
            <div class="row justify-content-center"><h5 class="col-auto">Search your next job</h5></div>
            <div class="row justify-content-center jobSearchArea">
                <input type="text" id="skills" class="col-sm-4 rounded border-0" placeholder="Search by skills">
                <input type="text" id="location" class="col-sm-3 rounded border-0" placeholder="Search by location">
                <button id="searchJobBtn" class="col-sm-2 rounded">Search</button>
            </div>
            <div class="row justify-content-center">
                <button id="postJobOptionBtn" class="rounded">Post a job</button>
            </div>
        </div>

        <br>

        <div id="output" class="container">
            <div class="container-fluid" id="jobpost">
                <div class="row justify-content-center">
                    <div class="form-group col-sm-3">
                        <label for="jobtitle">Job title<span style="color: blue;"> *</span></label>
                        <input class="col-sm rounded" id="jobtitle">
                    </div>
                    <div class="form-group col-sm-3">
                        <label for="companyname">Company name<span style="color: blue;"> *</span></label>
                        <input class="col-sm rounded" id="companyname">
                    </div>
                    <div class="form-group col-sm-3">
                        <label for="joblocation">Location<span style="color: blue;"> *</span></label>
                        <input class="col-sm rounded" id="joblocation">
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="form-group col-sm-9">
                        <label for="jobdescription">Job description<span style="color: blue;"> *</span></label>
                        <textarea class="form-control" id="jobdescription" rows="4"></textarea>
                    </div>
                </div>
                <div class="row justify-content-center"><p>Add skill keywords to make your job more visible to right candidate (Select upto 10)</p></div>
                <div class="row justify-content-center" id="selectskills">
                    <button class="btnkeyword" onclick="selectKeyword(this)">React</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Angular</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Boostrap</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Java</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Spring boot</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Design</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Web application</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Database</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Programming</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">MEAN</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">MongoDB</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Python</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Django</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Data analysis</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Data science</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Artificial intelligence</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">C</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">C++</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">Ruby</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">NodeJS</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">JavaScript</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">MERN</button>
                    <button class="btnkeyword" onclick="selectKeyword(this)">SQL</button>
                </div>

                <div class="row justify-content-center">
                    <button class="btn-success rounded" id="postjobbtn">Post job</button>
                </div>
                
            </div>
            <div class="container-fluid" id="jobresponse">
               
            </div>
        </div>
        
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
        
        <script>

            // var skillKeywords = ['React','Angular','Boostrap','Java','Spring boot','Design','Web application','Database','Programming','MEAN','MongoDB','Python','Django','Data analysis','Data science','Artificial intelligence','C','C++','Ruby','JavaScript','MERN','SQL'];

            document.getElementById('searchJobBtn').addEventListener('click', searchJob)
            document.getElementById('postJobOptionBtn').addEventListener('click', function() {
                document.getElementById('jobpost').style.display = "block";
                document.getElementById('jobresponse').style.display = "none";
            });
            document.getElementById('postjobbtn').addEventListener('click', postJob);

            var skillKeywords = [];

            function selectKeyword(btnEle) {
                                
                var compStyle = window.getComputedStyle(btnEle);   
                 
                if (compStyle.getPropertyValue('background-color') == "rgb(0, 115, 177)") {
                    
                    if (skillKeywords.length < 10) {
                        skillKeywords.push(btnEle.textContent);
                        btnEle.style.backgroundColor = "rgb(179, 0, 0)";
                    } else {
                        window.alert('You can select at max 10 skills.');
                    }
                    
                }
                else {
                    removeSkill(btnEle.textContent);
                    btnEle.style.backgroundColor = "rgb(0, 115, 177)";
                }
            }

            function removeSkill(skill) {
                for (var i in skillKeywords) {
                    if (skill == skillKeywords[i]) {
                        skillKeywords.splice(i, 1);
                    }
                }
            }

            function postJob() {
                var jobtitle = document.getElementById('jobtitle').value;
                var companyname = document.getElementById('companyname').value;
                var joblocation = document.getElementById('joblocation').value;
                var jobdescription = document.getElementById('jobdescription').value;

                if (jobtitle == '' || companyname == '' || joblocation == '' || jobdescription == '') {
                    window.alert('Please enter the required feilds.');
                    return;
                }

                if (skillKeywords.length == 0) {
                    window.alert('Please select some skills.');
                    return;
                }

                var data = JSON.stringify(
                    {
                        "companyName":companyname, 
                        "location":joblocation,
                        "jobDescription":jobdescription,
                        "skillKeywords":skillKeywords,
                        "jobTitle":jobtitle,
                        "expiryDuration":45  
                    }
                );

                var xhr = new XMLHttpRequest();

                var url = 'http://localhost:8081/jobs';

                xhr.open('PUT',url,true);

                xhr.setRequestHeader('Content-type', 'application/json');

                xhr.onload = function() {
                    if (xhr.status = 200) {
                        window.alert(xhr.responseText);
                    }
                }

                xhr.send(data);

            }

            function searchJob() {

                document.getElementById('jobresponse').style.display = "block";
                document.getElementById('jobpost').style.display = "none";

                var xhr = new XMLHttpRequest();

                console.log(document.getElementById('skills').value);
                var candidateskills = document.getElementById('skills').value;
                var candidatelocation = document.getElementById('location').value;

                var url = 'http://localhost:8081/jobs?skillKeywords='+encodeURIComponent(candidateskills)+'&location='+candidatelocation;

                //var url = 'http://localhost:8081/jobs?location=Hyderabad&skillKeywords=React';

                xhr.open('GET',url,true);

                xhr.onload = function() {
                    if(xhr.status == 200) {
                        
                        var response = JSON.parse(xhr.responseText);

                        var jobs = response.activeJobs;

                        var output = '';

                        if (jobs.length == 0) {
                            output += 
                            '<div class="row justify-content-center nomatchfoundalert rounded">'+
                                '<h6 class="col-auto">Sorry. No job matching your interest was found.</h6>'+
                            '</div>';
                        } else {
                            for (var i in jobs) {
                                console.log(jobs[i].jobDescription.split("\n").length);
                                
                                var jobDesc = jobs[i].jobDescription.replace(/\n/g,"<br>");

                                output += 
                                '<div class="job row justify-content-center rounded">'+
                                    '<div class="col-sm-3">'+
                                        '<ul class="list-unstyled">'+
                                        '<li><b>'+ jobs[i].jobTitle +'</b></li>'+
                                        '<li>Company name : '+ jobs[i].companyName +'</li>'+
                                        '</ul>'+
                                    '</div>'+
                                    '<div class="col-sm-7">'+
                                        '<p><b>Job description :</b></p>'+
                                        '<p>'+jobDesc+'</p>'+
                                    '</div>'+
                                '</div>'; 
                            }
                        }
                        
                        document.getElementById('jobresponse').innerHTML = output;

                    }
                }

                xhr.send();
            }

        </script>
    </body>
</html>